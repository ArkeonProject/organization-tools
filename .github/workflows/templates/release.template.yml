name: Release

on:
  push:
    branches:
      - main
  workflow_dispatch:
    inputs:
      version-bump:
        description: 'Version bump type'
        required: true
        type: choice
        options:
          - patch
          - minor
          - major
        default: minor

jobs:
  prepare-release:
    name: Prepare Release
    if: github.event_name == 'workflow_dispatch'
    uses: ArkeonProject/organization-tools/.github/workflows/release-prepare.yml@v1.0.1
    with:
      version-bump: ${{ github.event.inputs.version-bump }}
      project-type: 'node'
      base-branch: 'develop'
    secrets: inherit
  
  publish-release:
    name: Publish Release
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    uses: ArkeonProject/organization-tools/.github/workflows/release-publish.yml@v1.0.1
    with:
      project-type: 'node'
      create-github-release: true
      auto-back-merge: true
    secrets: inherit
