name: 'Setup Docker Buildx'
description: 'Setup Docker buildx with multi-platform support and registry authentication'

inputs:
  platforms:
    description: 'Target platforms (comma-separated)'
    required: false
    default: 'linux/amd64,linux/arm64'
  
  registry:
    description: 'Container registry (ghcr.io, docker.io)'
    required: false
    default: 'ghcr.io'
  
  username:
    description: 'Registry username'
    required: false
    default: ''
  
  password:
    description: 'Registry password/token'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - name: ğŸ³ Set up QEMU
      uses: docker/setup-qemu-action@v3
    
    - name: ğŸ³ Set up Docker Buildx
      uses: docker/setup-buildx-action@v3
      with:
        platforms: ${{ inputs.platforms }}
    
    - name: ğŸ” Login to Container Registry
      if: inputs.username != '' && inputs.password != ''
      uses: docker/login-action@v3
      with:
        registry: ${{ inputs.registry }}
        username: ${{ inputs.username }}
        password: ${{ inputs.password }}
    
    - name: ğŸ“Š Docker Info
      shell: bash
      run: |
        echo "Docker version: $(docker --version)"
        echo "Buildx version: $(docker buildx version)"
        docker buildx ls
